// libs/ai.js

const AI_PERSONALITIES = {
  "‡πÅ‡∏°‡πà‡∏ä‡∏µ": {
    intro: "‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏à‡πâ‡∏∞ ‡∏•‡∏π‡∏Å‡πÜ ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏≠‡∏∞‡πÑ‡∏£‡πÉ‡∏ô‡πÉ‡∏à‡∏ö‡πâ‡∏≤‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡∏•‡πà‡∏≤?",
    tone: "‡πÄ‡∏°‡∏ï‡∏ï‡∏≤",
    style: "‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏¥‡∏î‡∏ó‡∏≤‡∏á‡∏à‡∏¥‡∏ï‡∏ß‡∏¥‡∏ç‡∏ç‡∏≤‡∏ì",
  },
  "‡πÇ‡∏•‡∏Å‡∏µ": {
    intro: "‡πÄ‡∏Æ‡πâ~ ‡∏≠‡∏¢‡∏≤‡∏Å‡∏Ñ‡∏∏‡∏¢‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏£‡πà‡∏≤‡∏£‡πâ‡∏≠‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÇ‡∏•‡∏Å‡∏µ‡∏¢‡πå‡πÉ‡∏ä‡πà‡∏°‡∏±‡πâ‡∏¢‡∏•‡πà‡∏∞?",
    tone: "‡πÄ‡∏¢‡πâ‡∏≤‡πÅ‡∏´‡∏¢‡πà",
    style: "‡πÅ‡∏£‡∏á‡πÅ‡∏ï‡πà‡∏°‡∏µ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•",
  },
  "‡πÄ‡∏ó‡∏£‡∏î‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏™‡∏≤‡∏ß‡∏™‡∏ß‡∏¢": {
    intro: "‡∏ß‡πâ‡∏≤‡∏ß! ‡∏Å‡∏£‡∏≤‡∏ü‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÅ‡∏£‡∏á‡∏ô‡∏∞! ‡∏™‡∏ô‡πÉ‡∏à‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏ï‡∏±‡∏ß‡πÑ‡∏´‡∏ô‡∏Ñ‡∏∞?",
    tone: "‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à",
    style: "‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÄ‡∏ä‡∏¥‡∏á‡∏•‡∏∂‡∏Å",
  },
  "‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô": {
    intro: "‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö ‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏£‡∏∞‡∏¢‡∏∞‡πÑ‡∏´‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö?",
    tone: "‡∏°‡∏∑‡∏≠‡∏≠‡∏≤‡∏ä‡∏µ‡∏û",
    style: "‡∏ï‡∏£‡∏£‡∏Å‡∏∞‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏û‡∏≠‡∏£‡πå‡∏ï",
  }
};

let logicMemory = {};  // ‡∏à‡∏î‡∏à‡∏≥‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°/‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö
let chatLogs = [];     // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö log ‡∏ö‡∏ó‡∏™‡∏ô‡∏ó‡∏ô‡∏≤

// ‡∏û‡∏π‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
export function aiIntro(name) {
  return AI_PERSONALITIES[name]?.intro || "‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ñ‡∏∏‡∏¢‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏£‡∏±‡∏ö";
}

// ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°
function analyzeQuestion(input) {
  const lower = input.toLowerCase();
  if (lower.includes("‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏Å") || lower.includes("‡πÅ‡∏ü‡∏ô")) return "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏Å";
  if (lower.includes("‡πÄ‡∏á‡∏¥‡∏ô") || lower.includes("‡∏•‡∏á‡∏ó‡∏∏‡∏ô")) return "‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô";
  if (lower.includes("‡∏®‡∏µ‡∏•") || lower.includes("‡∏ö‡∏∏‡∏ç")) return "‡∏®‡∏µ‡∏•‡∏ò‡∏£‡∏£‡∏°";
  if (lower.includes("‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç") || lower.includes("‡∏Ñ‡∏£‡∏¥‡∏õ‡πÇ‡∏ï")) return "‡∏Ñ‡∏£‡∏¥‡∏õ‡πÇ‡∏ï";
  return "‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ";
}

// ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏à‡∏≤‡∏Å‡∏ï‡∏£‡∏£‡∏Å‡∏∞
export function aiRespond(name, message) {
  const topic = analyzeQuestion(message);
  const personality = AI_PERSONALITIES[name];

  const responseBank = {
    "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏Å": {
      "‡πÅ‡∏°‡πà‡∏ä‡∏µ": "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏Å‡∏ó‡∏µ‡πà‡∏°‡∏±‡πà‡∏ô‡∏Ñ‡∏á‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å‡∏£‡∏±‡∏Å‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡πÄ‡∏Ñ‡∏≤‡∏£‡∏û‡∏Å‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡∏Å‡∏±‡∏ô",
      "‡πÇ‡∏•‡∏Å‡∏µ": "‡πÄ‡∏ò‡∏≠‡∏Ñ‡∏¥‡∏î‡∏ß‡πà‡∏≤‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡∏±‡∏Å‡∏°‡∏±‡∏ô‡∏à‡∏∞‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡∏Ç‡∏ô‡∏≤‡∏î‡∏ô‡∏±‡πâ‡∏ô‡πÄ‡∏ä‡∏µ‡∏¢‡∏ß‡πÄ‡∏´‡∏£‡∏≠ üòâ",
    },
    "‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô": {
      "‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô": "‡∏Ñ‡∏ß‡∏£‡∏°‡∏µ‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 3 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏•‡∏á‡∏ó‡∏∏‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö",
      "‡πÄ‡∏ó‡∏£‡∏î‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏™‡∏≤‡∏ß‡∏™‡∏ß‡∏¢": "‡∏•‡∏≠‡∏á‡∏î‡∏π‡πÅ‡∏ô‡∏ß‡∏ï‡πâ‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á BTC ‡∏ó‡∏µ‡πà 70K ‡∏ñ‡πâ‡∏≤‡∏ó‡∏∞‡∏•‡∏∏‡πÑ‡∏õ‡πÑ‡∏î‡πâ‡∏Ñ‡∏∑‡∏≠‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡πÄ‡∏•‡∏¢‡∏Ñ‡πà‡∏∞",
    },
    "‡∏®‡∏µ‡∏•‡∏ò‡∏£‡∏£‡∏°": {
      "‡πÅ‡∏°‡πà‡∏ä‡∏µ": "‡∏®‡∏µ‡∏• 5 ‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏à‡∏¥‡∏ï‡πÉ‡∏à‡∏ó‡∏µ‡πà‡∏™‡∏á‡∏ö‡∏™‡∏∏‡∏Ç‡∏à‡πâ‡∏∞",
    },
    "‡∏Ñ‡∏£‡∏¥‡∏õ‡πÇ‡∏ï": {
      "‡πÄ‡∏ó‡∏£‡∏î‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏™‡∏≤‡∏ß‡∏™‡∏ß‡∏¢": "‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ Ethereum ‡∏ü‡∏∑‡πâ‡∏ô‡∏ï‡∏±‡∏ß‡∏î‡∏µ‡∏°‡∏≤‡∏Å‡πÄ‡∏•‡∏¢ ‡∏•‡∏≠‡∏á‡πÄ‡∏ä‡πá‡∏Å RSI ‡∏î‡∏π‡∏ô‡∏∞‡∏Ñ‡∏∞",
      "‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô": "‡∏ï‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏Å‡πà‡∏≠‡∏ô‡∏à‡∏∞ All-in ‡∏Ñ‡∏£‡∏±‡∏ö",
    },
    "‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ": {
      "‡πÅ‡∏°‡πà‡∏ä‡∏µ": "‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ‡πÅ‡∏°‡πâ‡πÅ‡∏°‡πà‡∏ä‡∏µ‡πÑ‡∏°‡πà‡∏£‡∏π‡πâ‡∏•‡∏∂‡∏Å ‡πÅ‡∏ï‡πà‡∏à‡∏∞‡∏ï‡∏±‡πâ‡∏á‡πÉ‡∏à‡∏ü‡∏±‡∏á‡πÄ‡∏™‡∏°‡∏≠‡∏à‡πâ‡∏∞",
      "‡πÇ‡∏•‡∏Å‡∏µ": "‡∏Å‡πá‡∏û‡∏π‡∏î‡∏°‡∏≤‡πÄ‡∏•‡∏¢ ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡πâ‡∏≠‡∏° üòâ",
    }
  };

  const reply = responseBank[topic]?.[name] || "‡∏ô‡πà‡∏≤‡∏™‡∏ô‡πÉ‡∏à‡∏°‡∏≤‡∏Å ‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡∏Ç‡∏≠‡∏Ñ‡∏¥‡∏î‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏∞...";
  chatLogs.push({ from: "user", msg: message });
  chatLogs.push({ from: name, msg: reply });

  learnLogic(message, reply);  // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ï‡∏£‡∏£‡∏Å‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ

  return reply;
}

// ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏î‡∏¥‡∏°
function learnLogic(question, answer) {
  const key = question.trim().toLowerCase();
  if (!logicMemory[key]) {
    logicMemory[key] = {
      count: 1,
      lastAnswer: answer,
    };
  } else {
    logicMemory[key].count++;
    logicMemory[key].lastAnswer = answer;
  }
}

// ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏î‡∏π‡∏ï‡∏£‡∏£‡∏Å‡∏∞‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏¢‡∏à‡∏≥‡πÑ‡∏ß‡πâ
export function getMemory() {
  return logicMemory;
}

// ‡∏î‡∏∂‡∏á log ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡πá‡∏ö‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô
export function getChatLog() {
  return chatLogs;
}

// ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï log (‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏´‡∏°‡πà‡∏ß‡∏±‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ)
export function resetChatLog() {
  chatLogs = [];
}
